name: Deploy
on:
  workflow_run:
    workflows: ['E2E Tests']
    types:
      - completed
    branches: [main]
jobs:
  deploy:
    timeout-minutes: 60
    # 이 작업은 E2E 테스트가 성공한 후에만 실행됩니다.
    if: |
      github.event.workflow_run.conclusion == 'success' &&
      github.event.workflow.id == 'test-e2e.yml'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}
      - name: Deploy 브랜치로 머지
        # 토큰을 사용하여 브랜치 생성 혹은 푸시
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git fetch origin
          git switch origin/deploy || git switch -c deploy
          git merge origin/main --ff-only
          git push origin deploy --force
