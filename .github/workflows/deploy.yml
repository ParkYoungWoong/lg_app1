name: Deploy
on:
  workflow_run:
    workflows: ['E2E Tests']
    types:
      - completed
    branches: [main]
jobs:
  deploy:
    # 이전 작업이 성공한 경우에만 실행
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    timeout-minutes: 60
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}
      - name: Deploy 브랜치로 머지
        # 토큰을 사용하여 브랜치 생성 혹은 푸시
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git fetch origin
          git switch origin/deploy || git switch -c deploy
          git merge origin/main --ff-only
          git push origin deploy --force
